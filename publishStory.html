<html>
<head>
<style>

table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
</head>
<body>
<table id="table">

</table>

<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-database.js"></script>

<script>
   // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAyPpwYB1X-e5VnUkUgJ2orPcDr9ybDHEU",
    authDomain: "draggable-9f92b.firebaseapp.com",
    databaseURL: "https://draggable-9f92b.firebaseio.com",
    projectId: "draggable-9f92b",
    storageBucket: "draggable-9f92b.appspot.com",
    messagingSenderId: "1010593277055",
    appId: "1:1010593277055:web:1b729dc7368b8f6f"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  
  const outputTitolo = document.getElementById("outputTitolo");
  const outputStoria = document.getElementById("outputStoria");
  const outputAutore = document.getElementById("outputAutore");
  const outputEmail = document.getElementById("outputEmail");
  
var ref = firebase.database().ref("waitinglist");
ref.once("value")
  .then(function(snapshot) {
var mytable = "";
 try {
	var nstories = Object.keys(snapshot.val());
	var aut = []; var tit = []; var par = []; var mail = [];
	var autore = ""; var titolo = ""; var storia = ""; 	var email = ""; 
	var i;
	for (i = 0; i< nstories.length; i++) {
		autore = snapshot.child(nstories[i]).val().autore;
		titolo = snapshot.child(nstories[i]).val().titolo;
		storia = snapshot.child(nstories[i]).val().storia;
		email = snapshot.child(nstories[i]).val().email;
		aut.push(autore);
		tit.push(titolo);
		par.push(storia);
		mail.push(email);
	}
} catch(err) {
	mytable = "<h2>Nessuna storia da pubblicare</h2>\n";
}
var i;
for (i in tit) {
		autore = snapshot.child(nstories[i]).val().autore;
	titolo = snapshot.child(nstories[i]).val().titolo;
	storia = snapshot.child(nstories[i]).val().storia;
	email = snapshot.child(nstories[i]).val().email;
	mytable+="<tr id=\""+i+"\">"+"\n"+
	"<td>"+autore+"</td>"+"\n"+
    "<td>"+titolo+"</td>"+"\n"+
	"<td>"+storia+"</td>"+"\n"+
	"<td><button onclick=\"publish("+i+")\">Publish</button>"+"\n"+
  	"<button onclick=\"mydelete("+i+")\">Delete</button></td>"+"\n"+
  "</tr>"+"\n"
  ;
  }
  
document.getElementById("table").innerHTML = 
  "<h3>Waiting List</h3>"+"\n"+
  "<tr>"+"\n"+
    "<th>Author</th>"+"\n"+
    "<th>Title</th>"+"\n"+
    "<th>Story</th>"+"\n"+
	"</tr>"+"\n"+
mytable
  ;
});

  
  function mydelete(ind) {   ref.once("value")
  .then(function(snapshot) {
	var nstories = Object.keys(snapshot.val());
	firebase.database().ref('waitinglist/'+nstories[ind]).remove();
	location.reload();
	});
	}
	
  function publish(ind) {
   ref.once("value")
  .then(function(snapshot) {
  
		var nstories = Object.keys(snapshot.val());
		var aut = []; var tit = []; var par = []; var mail = [];
		var autore = ""; var titolo = ""; var storia = ""; 	var email = ""; 
		var i;
		for (i = 0; i< nstories.length; i++) {
			autore = snapshot.child(nstories[i]).val().autore;
			titolo = snapshot.child(nstories[i]).val().titolo;
			storia = snapshot.child(nstories[i]).val().storia;
			email = snapshot.child(nstories[i]).val().email;
			aut.push(autore);
			tit.push(titolo);
			par.push(storia);
			mail.push(email);
		}
		document.getElementById(ind).innerHTML = "";
		
		firebase.database().ref('published/'+nstories[ind]).set({
		autore: aut[ind],
		titolo: tit[ind],
		storia: par[ind],
		email: par[ind],
	  });
	firebase.database().ref('waitinglist/'+nstories[ind]).remove();
	location.reload();
	})
	
  }
 

  
</script>
</body>
</html>